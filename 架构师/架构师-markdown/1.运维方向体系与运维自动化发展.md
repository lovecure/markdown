# 总结:


1.
2.
3.<pre>规范化  流程化 文档化  目标：文档化
        一切，从现在开始 不要抱怨以前如何
        工具化与标准化是相辅相成的关系</pre>

4.<mark>企业招聘是看重的是是否可以干活</mark>


<br>
</br>

-----
<br>
</br>
<br>
</br>

## 一、运维方向

### 1.IT环境
> 企业IT架构已经越来越多的<mark>向云发展</mark>

> 管理模式发生变化

> 创业公司会选择云主机

<br>
</br>

### 2.运维大环境
>公有云的核心竞争力是:运维 
>>     第一位：可靠、稳定，高速发展时期客户就是财富

>>     公有云 ----> 自动化运维
>>     运维冲击:技术要求越来越高(深度)

>>     两级划分：操作运维，会操作懂原理	
>>     不仅会用，还可以制作私有云
>>     自动化调用API（需要开发技术和自动化技术）

<br>
</br>

## 二、运维学习和发展的线路

### 思路与层次: 
#### 1.搭建 
    基础部署并运行
    
<br>
</br>

#### 2.用好
    服务中的各环节,监控、管理、优化 需要知道服务在整体架构中的位置
<br>
</br>

#### 3.自动化     
    统筹安排把各服务自动化关联协同

<br>
</br>

#### 4.产品设计(产品即服务) 
<pre>比如监控宝、日志易产品为何成功(解决用户的痛点)
微信朋友圈 （虚荣心）
陌陌解决痛点（LBS单身交友）
美图解决痛点（爱美）</pre>

<br>
</br>

#### 5.需要的技能与发展路线

>系统架构师: 

    业务  网络 系统  数据库  开发  云计算  自动化  运维管理 服务管理 项目管理  测试

>发展之路: 

    高级运维工程师 架构师CTO  技术专家


<br>
</br>
<br>
</br>

## 三、运维体系工作内容分类



### 1.应用运维 
``熟悉业务、服务部署、项目上线、业务部署、版本管理、灰度发布``

### 2.安全运维 
``整体的安全方案、规范、漏洞监测、安全防护等``

### 3.系统运维 
``架构层面、分布式缓存、分布式文件系统、日志收集、环境规划（测试、开发、生产）架构设计、性能优化``

### 4.基础服务运维 
``内部DNS、负载均衡、系统监控、资产管理、运维平台、运维开发``

### 5.基础设施运维 
``系统初始化、网络维护``

### 6.监控运维 
``7*24运维值班、故障处理``

### 7.机房运维
``负责设备上下架、巡检、报修、硬件监控``


<br>
</br>
<br>
</br>


## 四、从运维自动化到运维智能化

### 自动化第一步:运维标准化

<br>
</br>

#### 1.物理设备层面
>       1. 服务器标签、设备负责人、设备采购详情、设备摆放标准(比如负载均衡高可用不能放在一个机柜里)
>       2. 网络划分、远程控制卡、网卡端口
>       3. 服务器机型、硬盘、内存统一，根据业务分类
>       4. 资产命名规范、编号规范、类型规范
>       5. 监控标准规范


#### 2.操作系统层面
>     1.操作系统版本
>     2.系统初始化（DNS、NTP、内核参数调优、rsyslog、主机名规范）
>     3.基础Agent配备(Zabbix Agent、Logstash、Saltstack minion) 
>     4.系统监控标准(CPU、内存、硬盘、网络、进程)

    
#### 3.应用服务层面

>     1.web服务器选型(Apache、Nginx)
>     2.进程启动用户、端口监听规范、日志收集规范（访问日志、错误日志、运行日志）
>     3.配置管理（配置文件规范、脚本规范）
>     4.架构规范（Nginx+Keepalived、LVS+Keepalived等等）
>     5.部署规范（位置、包命名等）


#### 4.运维操作层面
   
>       1.机房巡检流程 （周期、内容、报修流程）
>       2.业务部署流程 （先测试、后生产、回滚）
>       3.故障处理流程 （紧急处理、故障升级、重大故障管理）
>       4.工作日志流程 （如何编写工作日志 日期 姓名 工作明细 未完成工作）
>       5.业务上线流程 （项目发起 系统安装 部署 测试 监控 备份）
>       6.业务下线流程 （谁发起  数据如何处理）
>       7.运维安全规范 （密码复杂度、更改周期、VPN使用规范、服务器登录规范）


<br>
</br>
<br>
</br>

### 自动化第二步:运维工具化

> 标准化之后可以制作工具使系统更加标准

<br>
</br>

	目标：1.促进标准化的实施
	     2.将重复的操作，简单化
         3.将多次操作流程化
	     4.减少人为操作的低效和降低故障率
	

#### 1.工具
	1.shell脚本：（功能性脚本（流程）、检查性、报表性、）
	2.开源工具:zabbix、ELKStack、SaltStack、Cobbler 等等
   	
	
	
#### 2.工具的痛点 
        1.你至少要ssh到服务器执行,可能出错
        2.多个脚本有执行顺序的时候可能犯错，比如:游戏公司回档错误
        3.权限不好管理，日志无法统计
        4.无法避免手工操作
<pre>
例子:某天凌晨3点要对一台数据库从库进行停机升级,需要进行停机影响评估：
       
      1.凌晨3点有哪些定时任务连接该数据库，做数据报表统计
	  2.凌晨3点所有系统的定时任务有哪些
	  3.这些定时任务哪些连接了准备停止的从库
      4.哪些可以停，哪些不能停，哪些可以后补
	  5.这些需要后补的脚本是哪个业务的，谁加的，什么时候加的    
</pre>


<br>
</br>
<br>
</br>

### 第三步:运维web化

>简单的说：做成Web界面

<br>
</br>

#### 1.运维操作平台优点

>>      1.做成web界面
>>      2.权限控制
>>      3.日志记录
>>      4.弱化流程（固化防止出错） 
>>      5.不用SSH到服务器，减少人为操作造成的故障，可以操作回放 (WEB ssh)
>>      
>> 以上解决了运维工具的痛点 
       
<br>
</br>

#### 2.运维web平台举例
<pre>
DNSWeb管理        Bind-DLZ
监控Web管理        Zabbix
操作系统安装平台    Cobbler
负载均衡Web管理
</pre>

<br>
</br>
<br>
</br>


### 第四步:运维服务化

#### 1.API

>提供相应的接口调用,解决不同web管理平台直接频繁操作,一键到位

>>      DNS Web管理  Bind-DLZ   ----  dns-api
>>      负载均衡Web管理         ----  slb-api
>>      监控Web管理 Zabbix    ----  zabbix-api
>>      操作系统安装平台      ----  cobbler-api



#### 2.部署平台		
    配置管理平台	       ----  saltstack-api
    自动化测试平台	       ----  test-api

#### 3.某项业务机上线流程
    1.调用cobbler-api                     安装操作系统
    2.调用saltstack-api                   进行系统初始化
    3.调用dns-api                         解析主机名
    4.调用zabbix-api                      将该新上线机器加上监控
    5.再次调用saltstack-api                部署软件
    6.调用deploy-api                      将当前版本的代码部署到服务器上
    7.调用test-api	                        测试当前服务运行调用saltstack-api 进行系统初始化
    8.调用slb-api	                        将该节点加入集群





#### 4.运维自动化发展层级

<pre>
^ 智能化
| 服务化、API化
| web化、平台化
| 标准化、工具化
</pre>


<br>
</br>
<br>
</br>

### 第五步：运维智能化
智能化的自动化扩容（亚马逊、阿里云）
智能化缩容
服务降级(停不重要的业务)
故障自愈(可以自动对故障处理)





《电商秒杀虚拟化集群扩容》
			

触发机制---> 决策系统(决策树)---|
				|
				|	
一、Zabbix 触发Action 	<-------|		
		    
触发机制:
 1.当某个集群的访问量超过最大支撑量比如10000
   1.1 CPU使用率 内存使用率......
 2.并持续5分钟
 3.监测不是攻击
 4.资源池有可用资源
   4.1 当前后端服务支撑量是否超过阈值如果超过应该后端先扩容
   4.2 当前网络带宽使用率
   4.3 数据库是不是可以支撑当前并发
   4.4 如果是公有云---资金够否
 5.当前自动化扩展队列，是否有正在扩容的节点
 6.其他业务相关

先判断Buffer是否有最近x小时，已经移除之前创建的虚拟机
先查询软件版本是否与当前一致,如果一致直接跳过2、3、4
如果不一致跳过2、3

二、OpenStack 创建虚拟机
三、SaltStack 配置环境---- 监控
四、部署系统部署当前代码
五、测试服务是否可用(注意间隔和次数) 例子: curl 测试网站是否返回200如果没有sleep5秒在继续还没有sleep 10秒继续...... 还没则有提示:扩容失败
六、自动加入集群
七、通知(短信、邮件)


自动化缩容
	1.触发条件和决策
	2.从集群中移除节点-关闭监控-移除
	3.通知
	4.移除的节点放在Buffer里面待删除
	5.Buffer里面超过一天的虚拟机自动关闭存放在xx区
	6.xx区的虚拟机，每7天清理删除


Tips: "老板所期望的是可以让团队成长的人才，而不是默默干活的"


